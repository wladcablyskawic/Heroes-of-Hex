"use strict";var slice=[].slice;define("modules/clean/flux/store_mixin",[],function(){var e;return e=function(){var e;return e=1<=arguments.length?slice.call(arguments,0):[],{getInitialState:function(){return this._get_state_from_stores(this.props)},componentDidMount:function(){var t,i,n;for(t=0,i=e.length;i>t;t++)n=e[t],n.add_change_listener(this._handle_store_changed);return this.setState(this._get_state_from_stores(this.props))},componentWillUnmount:function(){var t,i,n,r;for(n=[],t=0,i=e.length;i>t;t++)r=e[t],n.push(r.remove_change_listener(this._handle_store_changed));return n},_handle_store_changed:function(){var e;return this.isMounted()&&(e=this._get_state_from_stores(this.props),null!=e)?this.setState(e):void 0}}}});var bind=function(e,t){return function(){return e.apply(t,arguments)}},indexOf=[].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/actions",["modules/clean/react/browse/api","modules/clean/react/browse/dispatcher","modules/clean/react/browse/store","modules/clean/react/browse/constants","modules/clean/history","modules/core/exception","modules/core/uri"],function(e,t,i,n,r,s,o){var a,l,u,d,p,c,f;return p=i.File,u=i.BrowseStore,a=n.BrowseActionTypes,d=n.Direction,c=n.FileTypes,f=s.assert,new(l=function(){function i(){this.deselectAllFiles=bind(this.deselectAllFiles,this),this.navigateToSelectedFileOrFolder=bind(this.navigateToSelectedFileOrFolder,this),this.navigateToFileOrFolder=bind(this.navigateToFileOrFolder,this),this.computeAndApplyDeltasFromNotServer=bind(this.computeAndApplyDeltasFromNotServer,this)}return i.prototype.load=function(e){var i,n,r;return r=e.path,n=e.files,i=e.context,t.dispatch({type:a.LOAD_PATH,data:{path:r,files:n,context:i}})},i.prototype.add=function(e){var i,n;return n=e.path,i=e.files,t.dispatch({type:a.ADD_FILES,data:{path:n,files:i}})},i.prototype.setPaginating=function(e){var i;return i=e.isPaginating,t.dispatch({type:a.SET_PAGINATING,data:{isPaginating:i}})},i.prototype.setMountPoints=function(e){var i;return i=e.mountPoints,t.dispatch({type:a.SET_MOUNT_POINTS,data:{mountPoints:i}})},i.prototype.setPath=function(i){var n,r;return r=i.path,n=i.onPathLoaded,t.dispatch({type:a.SET_PATH,data:{path:r}}),this.setPaginating({isPaginating:!1}),e.loadPath({path:r,pathLoadCallback:function(e){return function(t){var i,r,s;return s=t.path,r=t.files,i=t.context,e.load({path:s,files:r,context:i}),"function"==typeof n?n():void 0}}(this),filesAppendCallback:this.add,paginatingCallback:this.setPaginating,mountPointCallback:this.setMountPoints})},i.prototype.setUser=function(e){var i;return i=e.user,t.dispatch({type:a.SET_USER,data:{user:i}})},i.prototype.openPreview=function(e){var i;return i=e.file,t.dispatch({type:a.OPEN_PREVIEW,data:{file:i}})},i.prototype.closePreview=function(){return t.dispatch({type:a.CLOSE_PREVIEW,data:{file:null}})},i.prototype.setUrlPrefix=function(e){var i;return i=e.prefix,t.dispatch({type:a.SET_URL_PREFIX,data:{prefix:i}})},i.prototype.setUrl=function(e){var t,i;t=e.path,i={},"1"===r.deconstruct_url().qargs.d&&(i.d="1"),r.push_state(u.urlPrefix()+o.encode_parts(t),i)},i.prototype.copyFiles=function(t){var i,n;return i=t.files,n=t.newPath,e.copyFiles({files:i,newPath:n,onSuccess:this.setSelectedFiles})},i.prototype.deleteFiles=function(t){var i,n;return n=t.path,i=t.files,e.deleteFiles({path:n,files:i,onSuccess:this.applyFileDeltas})},i.prototype.moveFiles=function(t){var i,n,r;return r=t.path,i=t.files,n=t.newPath,e.moveFiles({path:r,files:i,newPath:n,onSuccess:this.applyFileDeltas})},i.prototype.renameFile=function(t){var i,n,r;return r=t.path,i=t.file,n=t.newPath,e.renameFile({path:r,file:i,newPath:n,onSuccess:this.applyFileDeltas})},i.prototype.applyFileDeltas=function(e){var i,n,r,s,o,l,u;for(l=e.path,r=e.fileDeltas,s=0,o=r.length;o>s;s++)u=r[s],n=u.before,i=u.after,f(null!=n||null!=i,"malformed delta encountered");return t.dispatch({type:a.CHANGE_FILES,data:{path:l,fileDeltas:r}})},i.prototype.computeMountChangesFromNotServer=function(e){var t,i,n,r,s,o,a,l,d,f,h,_,m,g;s=e.files,t=e.added,d=e.mount_points,_=u.mountPoints(),this.setMountPoints({mountPoints:d}),r=[],g=[],n=[];for(h in d)f=d[h],_[h]!==f&&n.push(f);for(h in _)f=_[h],d[h]!==f&&n.push(f);for(o=0,l=t.length;l>o;o++)a=t[o],a.type===c.SHARED_FOLDER||a.type===c.FOLDER&&(m=a.fq_path,indexOf.call(n,m)>=0)?(i=s.get(a.fq_path,null),r.push(null!=i?{before:i,after:p(a)}:{before:null,after:p(a)})):g.push(a);return{added:g,fileDeltas:r}},i.prototype.computeAndApplyDeltasFromNotServer=function(e){var t,i,n,r,s,o,a,l,d,c,f,h,_,m,g,E,F;for(m=e.path,g=e.payload,t=g.added,h=g.moved,F=g.removed,f=g.mount_points,_=g.parent_changes,f=g.mount_points,r=u.filesMap(),E=this.computeMountChangesFromNotServer({files:r,added:t,mount_points:f}),t=E.added,n=E.fileDeltas,console.log("NOTSERVER",g),s=0,l=t.length;l>s;s++)i=t[s],n.push({before:null,after:p(i)});for(o=0,d=h.length;d>o;o++)i=h[o],n.push({before:r.get(i[0],null),after:p(i[1])});for(a=0,c=F.length;c>a;a++)i=F[a],n.push({before:r.get(i,null),after:null});return this.applyFileDeltas({path:m,fileDeltas:n})},i.prototype.setSelectedFiles=function(e){var i;return i=e.files,t.dispatch({type:a.SET_SELECTED_FILES,data:{files:i}})},i.prototype.toggleFileSelected=function(e){var i;return i=e.file,t.dispatch({type:a.TOGGLE_FILE_SELECTED,data:{file:i}})},i.prototype.selectFilesInRangeTo=function(e){var i;return i=e.file,t.dispatch({type:a.SELECT_FILES_IN_RANGE_TO,data:{file:i}})},i.prototype.selectNeighboringFile=function(e){var i,n;return i=e.direction,(n=!i)===d.UP||n===d.DOWN?void console.err("Invalid direction",i):t.dispatch({type:a.SELECT_NEIGHBORING_FILE,data:{direction:i}})},i.prototype.extendSelectionRange=function(e){var i,n;return i=e.direction,(n=!i)===d.UP||n===d.DOWN?void console.err("Invalid direction",i):t.dispatch({type:a.EXTEND_SELECTION_RANGE,data:{direction:i}})},i.prototype.navigateToFileOrFolder=function(e){var t;return t=e.file,t.is_dir?this.setUrl({path:t.fq_path}):this.openPreview({file:t})},i.prototype.navigateToSelectedFileOrFolder=function(){var e;return e=u.selection(),1===e.count()?this.navigateToFileOrFolder({file:e.first()}):void 0},i.prototype.deselectAllFiles=function(){return this.setSelectedFiles({files:[]})},i.prototype.setShouldShowDeletedFiles=function(e){var i;return i=e.shouldShowDeletedFiles,i?r.update_query_param("d","1"):r.remove_query_param("d"),t.dispatch({type:a.SET_SHOULD_SHOW_DELETED_FILES,data:{shouldShowDeletedFiles:i}})},i.prototype.setMostRecentlyDraggedOverFile=function(e){var i;return i=e.file,i!==u.mostRecentlyDraggedOverFile()?t.dispatch({type:a.SET_MOST_RECENTLY_DRAGGED_OVER_FILE,data:{file:i}}):void 0},i}())}),define("modules/clean/react/browse/api",["modules/core/uri","modules/clean/ajax","modules/clean/pagination_manager","modules/clean/react/browse/store","modules/clean/notserver","modules/core/i18n"],function(e,t,i,n,r,s){var o,a,l,u,d,p;return u=n.File,a=n.BrowseStore,o=n.BrowseContext,l=n.Config,d=r.NotClients,p=s._,{_extractBrowseContext:function(e){var t,i;return t=null!=(i=e.containing_fq_path)?i:"",0!==t.indexOf("/")&&(t="/"+t),new o({currentNSID:e.containing_ns_id,currentFQPath:t,currentMountPoint:e.containing_mount_point,currentNSPath:e.containing_ns_path,currentSharedFolderPermissionRole:e.containing_sf_perm_role,currentNSAllowsNesting:e.containing_ns_allows_nesting,isInFolderMode:e.inside_dir,isInsideSharedFolder:e.inside_shared_folder,isInsideTeamFolder:e.inside_team_folder,isInsideNestedSharedFolder:e.is_nested_in_team_folder,config:new l({isSimpleSharingEnabled:e.simple_sharing_enabled,isPublicFolderEnabled:e.public_folder_enabled})})},loadPath:function(n){var r,s,o,l,u;return l=n.path,u=n.pathLoadCallback,r=n.filesAppendCallback,o=n.paginatingCallback,s=n.mountPointCallback,t.WebRequest({dataType:"json",url:e({path:"/browse"+l}),subject_user:a.user().id,success:function(e){return function(t){var n,d,p;return n=e._extractBrowseContext(t),s({mountPoints:t.ns_id_to_mount_point}),t.paginated?(o({isPaginating:!0}),d=t.first_page,p=new i,u({path:l,files:[],context:n}),p.initialize(t.first_page,"sjid","/browse_get_next",a.user().id,function(e,t){return r({path:l,files:t}),e.areAllItemsReady()?(o({isPaginating:!1}),e.stopAutoFetching()):void 0}),p.startAutoFetching()):(d=t.file_info,u({path:l,files:d,context:n}))}}(this),error:function(){}})},copyFiles:function(i){var n,r,s,o,l;return r=i.files,o=i.newPath,l=i.onSuccess,s=function(){var e,t,i;for(i=[],e=0,t=r.length;t>e;e++)n=r[e],i.push(n.fq_path);return i}(),t.WebProgressRequest({dataType:"json",url:e({path:"/cmd/copy"}),data:{files:s,to_path:o},subject_user:a.user().id,progress_text:p("Copying files..."),success:function(e){return r=function(){var t,i,r,s;for(r=e.new_browse_files,s=[],t=0,i=r.length;i>t;t++)n=r[t],s.push(new u(n));return s}(),l({files:r})},error:function(e){console.error(e)}})},deleteFiles:function(i){var n,r,s,o,l;return l=i.path,r=i.files,o=i.onSuccess,s=function(){var e,t,i;for(i=[],e=0,t=r.length;t>e;e++)n=r[e],i.push(n.fq_path);return i}(),t.WebProgressRequest({dataType:"json",url:e({path:"/cmd/delete"}),data:{fq_paths:s},subject_user:a.user().id,progress_text:p("Deleting files..."),success:function(){var e,t;return t=function(){var t,i,n;for(n=[],t=0,i=r.length;i>t;t++)e=r[t],n.push({before:e,after:null});return n}(),o({path:l,fileDeltas:t})},error:function(e){console.error(e)}})},moveFiles:function(i){var n,r,s,o,l,d;return d=i.path,r=i.files,o=i.newPath,l=i.onSuccess,d!==o?(s=function(){var e,t,i;for(i=[],e=0,t=r.length;t>e;e++)n=r[e],i.push(n.fq_path);return i}(),t.WebProgressRequest({dataType:"json",url:e({path:"/cmd/move"}),data:{files:s,to_path:o},subject_user:a.user().id,progress_text:p("Moving files..."),success:function(e){var t;return t=function(){var t,i,r,s;for(r=e.new_browse_files,s=[],t=0,i=r.length;i>t;t++)n=r[t],s.push({before:null,after:new u(n)});return s}(),l({path:d,fileDeltas:t})},error:function(e){console.error(e)}})):void 0},renameFile:function(i){var n,r,s,o;return o=i.path,n=i.file,r=i.newPath,s=i.onSuccess,console.log("0.1: "+(new Date).getMilliseconds()),t.WebRequest({dataType:"json",url:e({path:"/cmd/rename"+n.fq_path}),data:{to_path:r},subject_user:a.user().id,success:function(){return function(e){var t;return console.log("0.2: "+(new Date).getMilliseconds()),console.log("rename gave data"),console.log(e),t=new u(e.new_browse_files[0]),s({path:o,fileDeltas:[{before:n,after:t}]})}}(this),error:function(){}})},initFileEventListeners:function(i){var n,r;return r=d[a.user().id],n=r.subscribe_sfj({name:"BrowseEventDispatcher",handler:function(){return console.log("got notification, waiting 2 seconds to check contents (helps simulate slow connections)"),setTimeout(function(){var s,o,l,u;return console.log("1: "+(new Date).getMilliseconds()),l=a.path(),"/"===l&&(l=""),o={fq_dir:l,ns_map:function(){var e,t;e=r.get_ns_map(),t=[];for(s in e)u=e[s],t.push(s+"_"+u);return t}().join(","),show_deleted:!1},t.WebRequest({dataType:"json",url:e({path:"/update/list_dir"}),subject_user:a.user().id,data:o,success:function(){return function(e){return i({path:a.path(),payload:e}),r.handler_success(n,{ns_map:e.ns_map})}}(this)})},2e3)}})}}}),define("modules/clean/react/browse/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e});var extend=function(e,t){function i(){this.constructor=e}for(var n in t)hasProp.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/react/browse/store",["external/immutable","modules/core/exception","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/constants/legacy","modules/clean/react/file_uploader/store"],function(e,t,i,n,r,s){var o,a,l,u,d,p,c,f,h,_;return _=t.assert,o=n.BrowseActionTypes,c=n.NameSpaceAccess,d=n.Direction,h=s.UploaderActionTypes,p=e.Record({bytes:void 0,direct_blockserver_link:void 0,doc_preview_status:void 0,fq_path:void 0,href:void 0,htmlified_link:void 0,icon:void 0,is_dir:!1,is_read_only_mount:!1,linkfile_link:void 0,ns_id:0,ns_path:void 0,preview_type:void 0,size:-1,sjid:0,target_ns:0,thumbnail_url_tmpl:void 0,ts:0,type:null,video_transcode_url:void 0}),f=e.Record({files:e.OrderedSet(),rangeAnchorFile:null}),u=e.Record({isSimpleSharingEnabled:!1,isPublicFolderEnabled:!1}),a=e.Record({currentNSID:r.root_ns,currentFQPath:null,currentMountPoint:null,currentNSPath:null,currentSharedFolderPermissionRole:c.ACCESS_VIA_TEAM,currentNSAllowsNesting:!1,isInFolderMode:!0,isInsideSharedFolder:!1,isInsideTeamFolder:!1,isInsideNestedSharedFolder:!1,config:new u}),l=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return extend(i,t),i.prototype._init=function(){return this._unsortedFiles=e.Map(),this._sortedFiles=e.List(),this._path="",this._user=null,this._urlPrefix="",this._previewFile=null,this._selection=new f,this._isPaginating=!1,this._context=new a,this._mountPoints=null,this._shouldShowDeletedFiles=!1,this._isFileBeingDragged=!1,this._mostRecentlyDraggedOverFile=null},i.prototype.files=function(){return this._sortedFiles},i.prototype.previewFile=function(){return this._previewFile},i.prototype.filesMap=function(){return this._unsortedFiles},i.prototype.path=function(){return this._path},i.prototype.user=function(){return this._user},i.prototype.urlPrefix=function(){return this._urlPrefix},i.prototype.selection=function(){return this._selection.files},i.prototype.isPaginating=function(){return this._isPaginating},i.prototype.context=function(){return this._context},i.prototype.mountPoints=function(){return this._mountPoints},i.prototype.shouldShowDeletedFiles=function(){return this._shouldShowDeletedFiles},i.prototype.getFileByFilename=function(e){var t,i;return t="/"===this._path?"/"+e:this._path+"/"+e,i=t.toLowerCase(),this._sortedFiles.find(function(e){return e.fq_path.toLowerCase()===i})},i.prototype.isFileBeingDragged=function(){return this._isFileBeingDragged},i.prototype.mostRecentlyDraggedOverFile=function(){return this._mostRecentlyDraggedOverFile},i.prototype._setUser=function(e){var t;return t=e.user,null==this.user()?this._user=t:void 0},i.prototype._setPathData=function(t){var i,n,r;return r=t.path,n=t.files,i=t.context,r===this.path()?(this._unsortedFiles=this._unsortedFiles.clear(),this._sortedFiles=this._sortedFiles.clear(),this._appendFiles({path:r,files:n}),this._selection=this._selection.set("files",e.OrderedSet()),this._context=i):void 0},i.prototype._appendFiles=function(t){var i,n,r;return r=t.path,n=t.files,r===this.path()?(this._unsortedFiles=this._unsortedFiles.merge(function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)i=n[e],r.push([i.fq_path,p(i)]);return r}()),this._sortedFiles=this._sortedFiles.concat(e.List(function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)i=n[e],r.push(this._unsortedFiles.get(i.fq_path));return r}.call(this))),_(this._unsortedFiles.size===this._sortedFiles.size,"appendFiles ended up with mismatched data structures"),this.emit_change()):void 0},i.prototype._applyFileDeltas=function(e){var t,i,n,r,s,o,a,l;if(a=e.path,n=e.fileDeltas,a===this.path()){for(r=function(e){return function(t,i){var n,r,s;if(i!==t)if(null!==i&&(null!=(s=e._unsortedFiles.get(i.fq_path))?s.sjid:void 0)>=i.sjid)console.log("happily ignoring delta:"),console.log({before:t,after:i});else{if(null===i)return _(e._unsortedFiles.has(t.fq_path),"before path doesn't exist"),_(-1!==e._sortedFiles.indexOf(t),"before file not in sorted Files"),e._unsortedFiles=e._unsortedFiles["delete"](t.fq_path),e._sortedFiles=e._sortedFiles["delete"](e._sortedFiles.indexOf(t));if(null!==t&&t.fq_path===i.fq_path)return _(e._unsortedFiles.has(t.fq_path),"fails at 3"),n=e._sortedFiles.indexOf(t),_(-1!==n,"fails at 3.1"),e._sortedFiles=e._sortedFiles.set(n,i),e._unsortedFiles=e._unsortedFiles.set(t.fq_path,i);if(null!==t)return _(e._unsortedFiles.has(t.fq_path),"fails at 3.5"),r=e._sortedFiles.indexOf(t),_(-1!==r,"fails at 3.2"),e._sortedFiles=e._sortedFiles["delete"](r),e._unsortedFiles=e._unsortedFiles["delete"](t.fq_path),e._unsortedFiles=e._unsortedFiles.set(i.fq_path,i),n=e._sortedFiles.findIndex(function(e){return e.fq_path>i.fq_path}),e._sortedFiles=-1===n?e._sortedFiles.push(i):e._sortedFiles.splice(n,0,i);if(null===t)return _(!e._unsortedFiles.has(i.fq_path),"fails at 5"),_(-1===e._sortedFiles.indexOf(i),"fails at 6"),e._unsortedFiles=e._unsortedFiles.set(i.fq_path,i),n=e._sortedFiles.findIndex(function(e){return e.fq_path>i.fq_path}),e._sortedFiles=-1===n?e._sortedFiles.push(i):e._sortedFiles.splice(n,0,i)}}}(this),s=0,o=n.length;o>s;s++)l=n[s],i=l.before,t=l.after,r(i,t);return _(this._unsortedFiles.size===this._sortedFiles.size,"applyFileDeltas ended up with mismatched data structures"),console.log("4: "+(new Date).getMilliseconds()),this.emit_change()}return console.log("Ignoring new state because path is different")},i.prototype._setPath=function(e){var t;return t=e.path,this._path=t,this.emit_change()},i.prototype._setUrlPrefix=function(e){var t;return t=e.prefix,this._urlPrefix=t,this.emit_change()},i.prototype._setPreviewFile=function(e){var t;return t=e.file,this._previewFile=t,this.emit_change()},i.prototype._setSelectedFiles=function(t){var i,n;return i=t.files,this._selection=this._selection.set("files",e.OrderedSet(i)),n=i.length>0?i[0]:this._sortedFiles.get(0),this._selection=this._selection.set("rangeAnchorFile",n),this.emit_change()},i.prototype._setPaginating=function(e){var t;return t=e.isPaginating,this._isPaginating=t,this.emit_change()},i.prototype._setMountPoints=function(e){var t;return t=e.mountPoints,this._mountPoints=t},i.prototype._toggleFileSelected=function(e){var t,i,n,r,s,o,a,l,u,d;if(i=e.file,this._selection.files.has(i)){for(this._selection=this._selection.update("files",function(e){return e["delete"](i)}),a=null,t=this._sortedFiles.indexOf(i),n=s=l=t+1,u=this._sortedFiles.count();u>=l?u>s:s>u;n=u>=l?++s:--s)if(r=this._sortedFiles.get(n),this._selection.files.has(r)){a=r;break}if(null==a)for(n=o=d=t-1;0>=d?0>=o:o>=0;n=0>=d?++o:--o)if(r=this._sortedFiles.get(n),this._selection.files.has(r)){a=r;break}null==a&&(a=this._sortedFiles.get(0)),this._selection=this._selection.set("rangeAnchorFile",a)}else this._selection=this._selection.update("files",function(e){return e.add(i)}).set("rangeAnchorFile",i);return this.emit_change()},i.prototype._rangeOfSelectedBlockSurrounding=function(e){var t,i,n,r;for(i=this._sortedFiles.indexOf(e);;)if(r=i,i-=1,0>i||!this._selection.files.has(this._sortedFiles.get(i)))break;for(i=r;;){if(n=this._sortedFiles.get(i),null==n||!this._selection.files.has(n))break;t=i,i+=1}return{startIndex:r,endIndex:t}},i.prototype._selectFilesInRangeTo=function(e){var t,i,n,r,s,o,a,l,u,d,p,c;return s=e.file,t=null!=(d=this._selection.rangeAnchorFile)?d:this._sortedFiles.get(0),null!=t?(i=this._sortedFiles.indexOf(t),u=this._sortedFiles.indexOf(s),p=this._rangeOfSelectedBlockSurrounding(t),c=p.startIndex,n=p.endIndex,o=function(){var e,t,i,s;for(i=this._sortedFiles.toArray(),s=[],l=e=0,t=i.length;t>e;l=++e)r=i[l],l>=c&&n>=l&&s.push(r);return s}.call(this),a=function(){var e,t,n,s;for(n=this._sortedFiles.toArray(),s=[],l=e=0,t=n.length;t>e;l=++e)r=n[l],(l>=u&&i>=l||l>=i&&u>=l)&&s.push(r);return s}.call(this),i>u&&a.reverse(),this._selection=this._selection.update("files",function(e){return e.subtract(o).union(a)}),this.emit_change()):void 0},i.prototype._selectNeighboringFile=function(e){var t,i,n;return t=e.direction,n=this._sortedFiles.indexOf(this._selection.files.last()),i=0,t===d.UP?i=Math.max(0,n-1):t===d.DOWN&&(i=Math.min(this._sortedFiles.count()-1,n+1)),this._setSelectedFiles({files:[this._sortedFiles.get(i)]})},i.prototype._extendSelectionRange=function(e){var t,i,n,r,s,o,a;return n=e.direction,t=null!=(s=this._selection.rangeAnchorFile)?s:this._sortedFiles.get(0),null!=t?(i=this._sortedFiles.indexOf(t),o=this._rangeOfSelectedBlockSurrounding(t),a=o.startIndex,r=o.endIndex,n===d.UP?i===r?a-1>=0&&(this._selection=this._selection.update("files",function(e){return function(t){return t.add(e._sortedFiles.get(a-1))}}(this))):this._selection=this._selection.update("files",function(e){return function(t){return t["delete"](e._sortedFiles.get(r))}}(this)):n===d.DOWN&&(i===a||i!==r?r+1<this._sortedFiles.count()&&(this._selection=this._selection.update("files",function(e){return function(t){return t.add(e._sortedFiles.get(r+1))}}(this))):this._selection=this._selection.update("files",function(e){return function(t){return t["delete"](e._sortedFiles.get(a))}}(this))),this.emit_change()):void 0},i.prototype._setShouldShowDeletedFiles=function(e){var t;return t=e.shouldShowDeletedFiles,_(t===!0||t===!1,"Unexpected parameter to _setShouldShowDeletedFiles was not a boolean"),this._shouldShowDeletedFiles=t,this.emit_change()},i.prototype._setIsFileBeingDragged=function(e){var t;return t=e.numDraggingFiles,this._isFileBeingDragged=null!=t&&t>0,this.emit_change()},i.prototype._setMostRecentlyDraggedOverFile=function(e){var t;return t=e.file,this._mostRecentlyDraggedOverFile=t,this.emit_change()},i.prototype._new_payload=function(e){switch(e.action.type){case o.LOAD_PATH:return this._setPathData(e.action.data);case o.ADD_FILES:return this._appendFiles(e.action.data);case o.SET_PATH:return this._setPath(e.action.data);case o.SET_USER:return this._setUser(e.action.data);case o.SET_URL_PREFIX:return this._setUrlPrefix(e.action.data);case o.CHANGE_FILES:return this._applyFileDeltas(e.action.data);case o.OPEN_PREVIEW:return this._setPreviewFile(e.action.data);case o.CLOSE_PREVIEW:return this._setPreviewFile(e.action.data);case o.SET_SELECTED_FILES:return this._setSelectedFiles(e.action.data);case o.TOGGLE_FILE_SELECTED:return this._toggleFileSelected(e.action.data);case o.SELECT_FILES_IN_RANGE_TO:return this._selectFilesInRangeTo(e.action.data);case o.SELECT_NEIGHBORING_FILE:return this._selectNeighboringFile(e.action.data);case o.EXTEND_SELECTION_RANGE:return this._extendSelectionRange(e.action.data);case o.SET_PAGINATING:return this._setPaginating(e.action.data);case o.SET_MOUNT_POINTS:return this._setMountPoints(e.action.data);case o.SET_SHOULD_SHOW_DELETED_FILES:return this._setShouldShowDeletedFiles(e.action.data);case h.SET_NUM_DRAGGING_FILES:return this._setIsFileBeingDragged(e.action.data);case o.SET_MOST_RECENTLY_DRAGGED_OVER_FILE:return this._setMostRecentlyDraggedOverFile(e.action.data)}},i}(i),{BrowseStore:new l,File:p,BrowseContext:a,Config:u}});var indexOf=[].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/actions",["modules/core/i18n","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/filepath","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/browse/constants","modules/clean/base64"],function(e,t,i,n,r,s,o){var a,l,u,d,p,c,f,h,_,m,g;return _=e._,m=t.assert,g=n.file_extension_for_logging,h=r.UploaderStore,c=r.UploaderActionTypes,u=r.FileStatus,d=r.FileUpload,p=r.UploadErrorType,l=o.BrowseActionTypes,a=["pages","key","app","numbers","band","photolibrary","rcproject","rtfd","graffle","logic","logicx","lpdf","sketch","screenflow","scriv","dvdproj","mindnode","cmproj","xcodeproj","imovielibrary","mpkg","imovieproject","1password","agilekeychain","fcpbundle","abbu","mindnode","theater","gameproj","aplibrary","itlp","lrdata","ydevice","bundle","framework","plugin","kext","pkg"],f=function(){function e(){}return e.prototype.initPLU=function(){return s.isInitialized?void 0:(s.init(),s.onFilesAdded(function(e){return function(t){var n,r,s,o,l,u,d,f,h,m;for(r=function(){var e,i,n;for(n=[],e=0,i=t.length;i>e;e++)s=t[e],null==s.size&&n.push(s);return n}(),t=function(){var e,i,n;for(n=[],e=0,i=t.length;i>e;e++)s=t[e],null!=s.size&&n.push(s);return n}(),o=0,u=r.length;u>o;o++)n=r[o],i.dispatch({type:c.ADD_NEW_FAILED_FILE,data:{file:n,errorType:p.EMPTY_OR_FOLDER,errorMessage:_("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}});for(f=function(e){var t;return t=g(e.name),indexOf.call(a,t)>=0&&e.size%34===0||""===g(e.name)&&e.size%34===0&&e.size<=3400},m=function(){var e,i,n;for(n=[],e=0,i=t.length;i>e;e++)s=t[e],f(s)&&n.push(s);return n}(),t=function(){var e,i,n;for(n=[],e=0,i=t.length;i>e;e++)s=t[e],f(s)||n.push(s);return n}(),l=0,d=m.length;d>l;l++)h=m[l],i.dispatch({type:c.ADD_NEW_FAILED_FILE,data:{file:h,errorType:p.PACKAGE_FILE,errorMessage:_("This file is a package file and can’t be uploaded directly. To upload a package file via the web, try zipping it first.")}});return i.dispatch({type:c.QUEUE_UPLOADS,data:{files:t}}),e._frobPLU()}}(this)),s.onUploadProgress(function(e){var t,n,r,o,a;return h.isUploadCancelled(e.uploadId)?void 0:(o=e.percentUploaded,n=o*h.currentUpload().size/100,a=n+h.totalSizeOfCompletedUploads(),t=s.bytesPerSec(),r=h.fileList().count(function(e){var t;return(t=e.status)===u.PENDING||t===u.UPLOADING}),i.dispatch({type:c.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:o,numSecondsLeft:(h.totalSize()-a)/t+r}}))}),s.onFileUploaded(function(e){return function(t,n){var r;return h.isUploadCancelled(t.uploadId)?void 0:(r=JSON.parse(n.response),"error"in r?(s.removeFiles({files:[t]}),i.dispatch("ignored"===r.error?{type:c.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:p.IGNORED,errorMessage:_("This file was skipped because it’s an internal system file.")}}:{type:c.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:p.GENERIC}})):(m("complete"===r.status),m(r.total_size===t.size),m(r.upload_id===t.uploadId),i.dispatch({type:c.COMPLETE_UPLOAD,data:{uploadId:t.uploadId}})),e._frobPLU())}}(this)),s.onError(function(e){return function(t,n,r){return i.dispatch(h.fileList().has(t.uploadId)?{type:c.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:n,errorMessage:r}}:{type:c.ADD_NEW_FAILED_FILE,data:{file:t,errorType:n,errorMessage:r}}),e._frobPLU()}}(this)))},e.prototype.setPath=function(e){var t;return t=e.path,t!==h.path()?i.dispatch({type:c.SET_PATH,data:{path:t}}):void 0},e.prototype.setUser=function(e){var t;return t=e.user,i.dispatch({type:c.SET_USER,data:{user:t}})},e.prototype.setNumDraggingFiles=function(e){var t;return t=e.numDraggingFiles,i.dispatch({type:c.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:t}})},e.prototype.addFilesToPLU=function(e){var t;return t=e.files,s.addFiles({files:t}),this.setIsInlineStatusDismissed({isInlineStatusDismissed:!1})},e.prototype.addDirectoriesToPLU=function(e){var t,n,r,s,o,l,u,d,f,m,E,F;for(n=e.directoryEntries,t=h.path(),s=[],d=0,o=function(e){return function(){var t;return(t=function(){var i,n,r;return s.length>0?(r=s.pop(),n=r.entry,i=r.dest,n.file(function(n){return e.setPath({path:i}),e.addFilesToPLU({files:[n]}),t()})):void 0})()}}(this),f=function(e){var i,n;return d+=1,n=e.createReader(),(i=function(){return n.readEntries(function(n){var r,a,l;if(n.length>0){for(r=0,a=n.length;a>r;r++)l=n[r],l.isDirectory?f(l):s.push({entry:l,dest:t+e.fullPath});return i()}return d-=1,0===d?o():void 0})})()},E=[],l=0,u=n.length;u>l;l++)F=n[l],m=g(F.name),indexOf.call(a,m)>=0?(r=new File({name:F.name,dest:t}),E.push(i.dispatch({type:c.ADD_NEW_FAILED_FILE,data:{file:r,errorType:p.PACKAGE_FILE,errorMessage:_('Due to browser limitations, OSX package files files cannot be uploaded using drag-and-drop. Please try using the "Upload…" dialog.')}}))):E.push(f(F));return E},e.prototype.setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,i.dispatch({type:c.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},e.prototype.setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,i.dispatch({type:c.SET_IS_INLINE_STATUS_DISMISSED,data:{isInlineStatusDismissed:t}})},e.prototype.cancelUploads=function(e){var t;return t=e.files,s.removeFiles({files:t}),i.dispatch({type:c.CANCEL_UPLOADS,data:{files:t}}),this._frobPLU()},e.prototype._startUpload=function(e){var t;return t=e.file,i.dispatch({type:c.START_UPLOAD,data:{file:t}}),s.setAjaxParams({dest:t.dest,reported_total_size:t.size,uploadId:t.uploadId,_subject_uid:t.userId,offset:0,overwrite:0}),s.start(),!0},e.prototype._frobPLU=function(){var e;return e=h.nextUpload(),null!=e&&null==h.currentUpload()?(m(e instanceof d),this._startUpload({file:e})):void 0},e}(),{UploaderDispatcher:i,UploaderActions:new f}});var bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_uploader/plu_wrapper",["jquery","modules/core/exception","external/plupload_dev","external/react","external/underscore","modules/clean/static_urls","modules/core/cookies","modules/clean/react/file_uploader/store","modules/constants/request","modules/constants/env","modules/core/i18n"],function(e,t,i,n,r,s,o,a,l,u,d){var p,c,f,h,_,m,g,E,F,v,I;return F=t.assert,m=s.UrlConstants,_=a.UploaderStore,p=a.FileUpload,h=a.UploadErrorType,v=a.generateUploadId,g=d._,I=window.plupload,E=function(e,t){var i,n;return null==t&&(t={}),i=r.extend({},t,e),new p({uploadId:i.uploadId,dest:i.dest,name:i.name,size:i.size,userId:i.userId,percentUploaded:null!=(n=i.percent)?n:0})},f=function(){function t(){this.removeFiles=bind(this.removeFiles,this),this.bytesPerSec=bind(this.bytesPerSec,this),this.onError=bind(this.onError,this),this.onFileUploaded=bind(this.onFileUploaded,this),this.onUploadProgress=bind(this.onUploadProgress,this),this.onFilesAdded=bind(this.onFilesAdded,this),this.clearFlashShim=bind(this.clearFlashShim,this),this.setBrowseButton=bind(this.setBrowseButton,this),this.setAjaxParams=bind(this.setAjaxParams,this),this.start=bind(this.start,this),this.addFiles=bind(this.addFiles,this),this.init=bind(this.init,this),this.isInitialized=!1}return t.prototype.idToUploadIdMap={},t.prototype.PLU_CONTAINER_ID="flash-upload-container",t.prototype.init=function(){var t;if(!this.isInitialized)return this.isInitialized=!0,this.$secretBrowseButton=e("<button>").addClass("secret-file-uploader-button").hide().appendTo(e("body")),this.$pluContainer=e("<div>").attr("id",this.PLU_CONTAINER_ID).css({position:"absolute",left:-2e3}).appendTo(e("body")),this.$currentExternalBrowseButton=null,t={url:"https://"+u.BLOCK_CLUSTER+"/chunked_upload",file_data_name:"file",runtimes:this._runtimes,multipart_params:{},multipart:!1,max_file_size:"10000mb",chunk_size:"8mb",max_retries:2,browse_button:this.$secretBrowseButton[0],container:this.PLU_CONTAINER_ID,flash_swf_url:m.MOXIE_SWF_URL,init:{ChunkUploaded:function(e){return function(t,i,n){var r,s;return s=e.idToUploadIdMap[i.id],F(JSON.parse(n.response).upload_id===s),r=_.fileList().get(s),e.setAjaxParams({dest:r.dest,reported_total_size:r.size,uploadId:s,_subject_uid:r.userId,offset:n.offset,overwrite:0})}}(this)}},this.uploader=new I.Uploader(t),this.uploader.init()},t.prototype._runtimes=function(){var e,t,i,n;i={"MSIE 8.0":"flash","MSIE 9.0":"flash"},t="html5";for(e in i)n=i[e],-1!==navigator.userAgent.indexOf(e)&&(t=n);return t}(),t.prototype.addFiles=function(e){var t;return t=e.files,this.isInitialized||this.init(),this.uploader.addFile(t)},t.prototype.start=function(){return this.isInitialized||this.init(),this.uploader.start()},t.prototype.setAjaxParams=function(e){var t,i,n,r,s,a;if(s=e.reported_total_size,i=e.dest,a=e.uploadId,n=e.offset,t=e._subject_uid,r=e.overwrite,this.isInitialized||this.init(),null==s||null==i||null==a||null==n||null==t||null==r)throw new Error("A required parameter to setAjaxParams was not given.");return this.uploader.settings.multipart_params={t:o.read(l.JS_CSRF_COOKIE),reported_total_size:s,dest:i,upload_id:a,offset:n,_subject_uid:t,overwrite:r}},t.prototype.setBrowseButton=function(t){var i,n;return this.isInitialized||this.init(),this.$currentExternalBrowseButton=e(t),"flash"===this.uploader.runtime?(e("#"+this.PLU_CONTAINER_ID).show().css({"z-index":1e3,position:"absolute",top:this.$currentExternalBrowseButton.offset().top,
left:this.$currentExternalBrowseButton.offset().left,width:this.$currentExternalBrowseButton.outerWidth(),height:this.$currentExternalBrowseButton.outerHeight()}),i=e("#"+this.PLU_CONTAINER_ID+" > .moxie-shim"),i[0].style.top="0px",i[0].style.left="0px",i[0].style.width="100%",i[0].style.height="100%"):(null!=(n=this.$currentExternalBrowseButton)&&n.off("click.PLUBrowseButton"),this.$currentExternalBrowseButton.on("click.PLUBrowseButton",function(e){return function(){return e.$secretBrowseButton.click()}}(this)))},t.prototype.clearFlashShim=function(){return e("#"+this.PLU_CONTAINER_ID).hide()},t.prototype.onFilesAdded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FilesAdded",function(t){return function(i,n){var r;return r=n.map(function(e){var i;return i=v(),t.idToUploadIdMap[e.id]=i,E(e,{uploadId:i,dest:_.path(),userId:_.user().id})}),e(r)}}(this))},t.prototype.onUploadProgress=function(e){return this.isInitialized||this.init(),this.uploader.bind("UploadProgress",function(t){return function(i,n){var r,s;return s=t.idToUploadIdMap[n.id],r=_.fileList().get(s),e(r.set("percentUploaded",n.percent))}}(this))},t.prototype.onFileUploaded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FileUploaded",function(t){return function(i,n,r){var s,o;return o=t.idToUploadIdMap[n.id],s=_.fileList().get(o),e(s,r)}}(this))},t.prototype.onError=function(e){return this.isInitialized||this.init(),this.uploader.bind("Error",function(t){return function(i,n){var r,s,o,a;if(null==n.file)throw new Error("PLU error without an associated file.");return s=function(){switch(n.code){case I.FILE_SIZE_ERROR:return h.FILE_SIZE_ERROR;case I.HTTP_ERROR:return 0===n.status?h.CONNECTION_ERROR:507===n.status?h.OVER_QUOTA_ERROR:h.HTTP_ERROR;default:return h.GENERIC}}(),r=function(){switch(s){case h.OVER_QUOTA_ERROR:return g("This file can’t be uploaded because you are over your storage quota. If you believe this message to be in error, try refreshing the page.");case h.FILE_SIZE_ERROR:return g("This file is too large to upload using the Dropbox website. Please use the desktop client.");case h.HTTP_ERROR:return g("Something went wrong while uploading this file. There was a server error during the upload request. If the problem persists, please try the basic uploader.");case h.CONNECTION_ERROR:return g("Something went wrong while uploading this file. Check your connection to the internet and try again.");default:return g("Something went wrong while uploading this file. If the problem persists, please try the basic uploader.")}}(),a=t.idToUploadIdMap[n.file.id],o=_.fileList().has(a)?_.fileList().get(a):E(n.file,{uploadId:v(),dest:_.path()}),e(o,s,r)}}(this))},t.prototype.bytesPerSec=function(){var e;return this.isInitialized||this.init(),null!=(e=this.uploader.total)?e.bytesPerSec:void 0},t.prototype.removeFiles=function(e){var t,i,n,s,o,a;for(i=e.files,this.isInitialized||this.init(),a=[],n=0,s=i.length;s>n;n++)t=i[n],o=r.find(this.uploader.files,function(e){return function(i){return e.idToUploadIdMap[i.id]===t.uploadId}}(this)),a.push(this.uploader.removeFile(o));return a},t}(),c=new f});var extend=function(e,t){function i(){this.constructor=e}for(var n in t)hasProp.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/react/file_uploader/store",["modules/clean/base64","modules/core/exception","modules/clean/flux/base_store","external/immutable","modules/clean/react/browse/constants"],function(e,t,i,n,r){var s,o,a,l,u,d,p,c;return p=t.assert,s=r.BrowseActionTypes,u={SET_PATH:"UPLOADER_SET_PATH",SET_USER:"UPLOADER_SET_USER",SET_NUM_DRAGGING_FILES:"SET_NUM_DRAGGING_FILES",QUEUE_UPLOADS:"QUEUE_UPLOADS",START_UPLOAD:"START_UPLOAD",COMPLETE_UPLOAD:"COMPLETE_UPLOAD",CANCEL_UPLOADS:"CANCEL_UPLOADS",SET_CURRENT_UPLOAD_PROGRESS:"SET_CURRENT_UPLOAD_PROGRESS",UPLOAD_ERROR:"UPLOAD_ERROR",SET_IS_UPLOAD_MODAL_OPEN:"SET_IS_UPLOAD_MODAL_OPEN",SET_IS_INLINE_STATUS_DISMISSED:"SET_IS_INLINE_STATUS_DISMISSED",ADD_NEW_FAILED_FILE:"ADD_NEW_FAILED_FILE"},o={PENDING:"PENDING",UPLOADING:"UPLOADING",COMPLETE:"COMPLETE",CANCELLED:"CANCELLED",FAILED:"FAILED"},l={FILE_SIZE_ERROR:"FILE_SIZE_ERROR",HTTP_ERROR:"HTTP_ERROR",CONNECTION_ERROR:"CONNECTION_ERROR",OVER_QUOTA_ERROR:"OVER_QUOTA_ERROR",IGNORED:"IGNORED",EMPTY_OR_FOLDER:"EMPTY_OR_FOLDER",PACKAGE_FILE:"PACKAGE_FILE",GENERIC:"GENERIC"},a=n.Record({uploadId:void 0,dest:"",userId:null,name:"",size:0,percentUploaded:0,status:o.PENDING,errorType:l.GENERIC,errorMessage:""}),c=function(){var t,i,n,r;for(t="",i=n=0;15>=n;i=++n)t+=String.fromCharCode(Math.floor(256*Math.random()));return r=e.encode(t),r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),r=r.replace(/\=*$/,"")},d=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype._init=function(){return this._path="/",this._user=null,this._fileList=n.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isUploadModalOpen=!1,this._isInlineStatusDismissed=!1,this._numSecondsLeft=0},t.prototype.fileList=function(){return this._fileList},t.prototype.currentUpload=function(){return this._fileList.get(this._currentUploadId)},t.prototype.currentUploadPercentage=function(){return this.currentUpload().percentUploaded},t.prototype.numSecondsLeft=function(){return this._numSecondsLeft},t.prototype.isUploadCancelled=function(e){var t;return(null!=(t=this._fileList.get(e))?t.status:void 0)===o.CANCELLED},t.prototype.isInlineStatusDismissed=function(){return this._isInlineStatusDismissed},t.prototype.path=function(){return this._path},t.prototype.user=function(){return this._user},t.prototype.nextUpload=function(){return this._fileList.find(function(e){return e.status===o.PENDING})},t.prototype.numDraggingFiles=function(){return this._numDraggingFiles},t.prototype.totalSizeOfCompletedUploads=function(){return this._fileList.reduce(function(e,t){return t.status===o.COMPLETE?e+t.size:e},0)},t.prototype.totalSize=function(){return this._fileList.reduce(function(e,t){var i;return(i=t.status)===o.COMPLETE||i===o.PENDING||i===o.UPLOADING?e+t.size:e},0)},t.prototype.isUploadModalOpen=function(){return this._isUploadModalOpen},t.prototype._setUser=function(e){var t;return t=e.user,this._user=t,this.emit_change()},t.prototype._setPath=function(e){var t;return t=e.path,this._path=t,this.emit_change()},t.prototype._queueUploads=function(e){var t,i,n,r,s;for(i=e.files,s={},n=0,r=i.length;r>n;n++)t=i[n],s[t.uploadId]=t;return this._fileList=this._fileList.merge(s),this.emit_change()},t.prototype._startUpload=function(e){var t;return t=e.file,p(null==this._currentUpload),p(null!=t),p(this._fileList.get(t.uploadId)===t),this._fileList=this._fileList.update(t.uploadId,function(e){return e.set("status",o.UPLOADING)}),this._currentUploadId=t.uploadId,this.emit_change()},t.prototype._completeUpload=function(e){var t,i;return t=e.uploadId,i=this._fileList.find(function(e){return e.status===o.UPLOADING}),p(t===(null!=i?i.uploadId:void 0)),this._fileList=this._fileList.update(i.uploadId,function(e){return e.set("status",o.COMPLETE)}),this._currentUploadId=null,this.emit_change()},t.prototype._cancelUploads=function(e){var t,i,n,r;for(i=e.files,n=0,r=i.length;r>n;n++)t=i[n],this._fileList=this._fileList.update(t.uploadId,function(e){var t;return(t=e.status)===o.PENDING||t===o.UPLOADING?e.set("status",o.CANCELLED):e}),t.uploadId===this._currentUploadId&&(this._currentUploadId=null);return this.emit_change()},t.prototype._setCurrentUploadProgress=function(e){var t,i;return i=e.percentComplete,t=e.numSecondsLeft,this._fileList=this._fileList.update(this._currentUploadId,function(e){return e.set("percentUploaded",i)}),this._numSecondsLeft=t,this.emit_change()},t.prototype._handleUploadError=function(e){var t,i,n,r;return r=e.uploadId,i=e.errorType,t=e.errorMessage,n=this._fileList.get(r),p(n.uploadId===this._currentUploadId),this._fileList=this._fileList.update(n.uploadId,function(e){return e.set("status",o.FAILED).set("errorType",i).set("errorMessage",t)}),this._currentUploadId=null,this.emit_change()},t.prototype._setNumDraggingFiles=function(e){var t;return t=e.numDraggingFiles,this._numDraggingFiles=t,this.emit_change()},t.prototype._setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,this._isUploadModalOpen=t,this.emit_change()},t.prototype._setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,this._isInlineStatusDismissed=t,this.emit_change()},t.prototype._addNewFailedFile=function(e){var t,i,n;return n=e.file,i=e.errorType,t=e.errorMessage,null==n.uploadId&&(n=n.set("uploadId",c())),n=n.set("status",o.FAILED).set("errorType",i).set("errorMessage",t),this._fileList=this._fileList.set(n.uploadId,n),this.emit_change()},t.prototype._new_payload=function(e){switch(e.action.type){case s.SET_USER:case u.SET_USER:return this._setUser(e.action.data);case s.SET_PATH:case u.SET_PATH:return this._setPath(e.action.data);case u.QUEUE_UPLOADS:return this._queueUploads(e.action.data);case u.START_UPLOAD:return this._startUpload(e.action.data);case u.COMPLETE_UPLOAD:return this._completeUpload(e.action.data);case u.CANCEL_UPLOADS:return this._cancelUploads(e.action.data);case u.SET_CURRENT_UPLOAD_PROGRESS:return this._setCurrentUploadProgress(e.action.data);case u.UPLOAD_ERROR:return this._handleUploadError(e.action.data);case u.SET_NUM_DRAGGING_FILES:return this._setNumDraggingFiles(e.action.data);case u.SET_IS_UPLOAD_MODAL_OPEN:return this._setIsUploadModalOpen(e.action.data);case u.SET_IS_INLINE_STATUS_DISMISSED:return this._setIsInlineStatusDismissed(e.action.data);case u.ADD_NEW_FAILED_FILE:return this._addNewFailedFile(e.action.data)}},t}(i),{UploaderStore:new d,UploaderActionTypes:u,FileUpload:a,FileStatus:o,UploadErrorType:l,generateUploadId:c}}),define("modules/clean/react/file_uploader/uploader",["jquery","modules/core/i18n","modules/core/notify","modules/core/html","modules/core/uri","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/store","modules/clean/flux/store_mixin","external/react","modules/clean/react/modal","modules/clean/viewer","modules/clean/filepath","modules/clean/em_string","external/immutable","modules/clean/static_urls","modules/clean/react/sprite","modules/clean/react/image","modules/clean/datetime","modules/clean/react/button","modules/clean/display_format","modules/clean/react/browse/actions","modules/clean/react/react_i18n","modules/clean/react/tooltip","modules/clean/browse_interface","modules/constants/env","modules/constants/request","modules/core/cookies"],function(e,t,i,n,r,s,o,a,l,u,d,p,c,f,h,_,m,g,E,F,v,I,y,D,U,L,S,P){var N,T,O,b,w,R,A,C,x,M,G,B,k,z,q,H,j,W,V,Y,Z,$,Q,X,K,J,ee,te,ie,ne,re,se,oe,ae;return z=t._,ae=t.ungettext,B=o.UploaderActions,k=a.UploaderStore,T=a.FileUpload,N=a.FileStatus,G=a.UploadErrorType,R=d.Modal,se=_.static_url,W=F.button,C=y.R_,A=y.RP_,x=D.Tooltip,M=D.TooltipPosition,X=U.get_browse_root,K=U.get_browse_root_name,j=U.browse_uri_for_fq_path,V=u.createElement,Y=u.addons.classSet,ne=u.DOM,$=ne.div,H=ne.a,oe=ne.ul,te=ne.ol,ee=ne.li,re=ne.span,J=ne.input,Q=ne.form,ie=ne.p,Z=u.DOM,q=function(e){var t,i,n,r,s,o,a,l,u,d;return null==e&&(e={}),u=e.user,n=e.path,i=null!=(r=e.maxLength)?r:1e3,l=null!=(s=e.useHTMLFormatting)?s:!0,d=p.get_viewer(),d.is_paired&&u.is_team&&(a=f.em_snippet(d.team_name,i)),o="/"===n?d.is_paired?u.is_team?z(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:a}):z(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):z(" upload to your Dropbox"):(t=f.em_snippet(c.filename(n),i),d.is_paired?u.is_team?z(" upload to the folder <strong>%(folder)s</strong> in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:a}):z(" upload to the folder <strong>%(folder)s</strong> in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):z(" upload to the folder <strong>%(folder)s</strong>",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t})),l?o:o.replace("<strong>","'").replace("</strong>","'")},b=u.createClass({displayName:"FileUploaderModal",mixins:[l(k)],DROPZONE_ID:"upload-modal-dropzone",propTypes:{dragAndDropEnabled:u.PropTypes.bool},getDefaultProps:function(){return{dragAndDropEnabled:!0}},getInitialState:function(){return{usingBasicUploader:!1,basicUploaderFile:null}},_get_state_from_stores:function(){return{path:k.path(),user:k.user(),fileList:k.fileList(),numDraggingFiles:k.numDraggingFiles(),currentUpload:k.currentUpload(),numSecondsLeft:k.numSecondsLeft()}},componentDidMount:function(){return this._setBrowseButton(),e(window).on("resize.uploaderModal",function(e){return function(){return e._setBrowseButton()}}(this))},componentDidUpdate:function(t,n){var r,s,o,a,l;return this._setBrowseButton(),this.state.numDraggingFiles?this.state.usingBasicUploader?i.error("You can‖t drag and drop upload right now."):(r=e(this.refs.modal.refs.modalBox.getDOMNode()).find("#"+this.DROPZONE_ID),r.length||e("#"+this.DROPZONE_ID).clone().prependTo(e(this.refs.modal.refs.modalBox.getDOMNode())).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1)):e(this.refs.modal.getDOMNode()).find("#"+this.DROPZONE_ID).remove(),this.state.fileList.count()>n.fileList.count()&&(a=e(this.refs.uploadFilesList.getDOMNode()),s=null!=(l=a.find(".upload-file"))?l.eq(n.fileList.count()):void 0,s.length&&a.scrollTop(a.scrollTop()+s.position().top)),o=e(this.getDOMNode()),o.find(".basic-uploader-link").off("click.switchUploader").on("click.switchUploader",function(e){return function(t){return t.preventDefault(),e.setState({usingBasicUploader:!0})}}(this)),o.find(".enhanced-uploader-link").off("click.switchUploader").on("click.switchUploader",function(e){return function(t){return t.preventDefault(),e.setState({usingBasicUploader:!1})}}(this))},componentWillUnmount:function(){return s.clearFlashShim(),e(window).off("resize.uploaderModal")},FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_setBrowseButton:function(){return null!=this.refs.pluFileChooseButton?s.setBrowseButton(this.refs.pluFileChooseButton.getDOMNode()):s.clearFlashShim()},_handleClose:function(){var e;e=this.state.fileList.find(function(e){var t;return(t=e.status)===N.PENDING||t===N.UPLOADING}),e||B.setIsInlineStatusDismissed({isInlineStatusDismissed:!0}),B.setIsUploadModalOpen({isUploadModalOpen:!1}),R.close()},_handleCancel:function(e){return B.cancelUploads({files:[e]})},_handleBasicChooseButtonMouseMove:function(t){var i,n;return null!=this.refs.fileInput?(i=e(this.refs.fileInput.getDOMNode()),n=i.offsetParent(),i.css({top:t.clientY-n.offset().top-3,left:t.clientX-n.offset().left-i.outerWidth()+3})):void 0},_handleBasicFileInputChange:function(){var e,t,i,n,r;return i=this.refs.fileInput.getDOMNode(),t=null!=(n=i.files)&&"function"==typeof n.item?n.item(0):void 0,r=i.value,null!=t?this.setState({basicUploaderFile:new T({name:t.name,size:t.size,dest:this.state.path,userId:this.state.user.id,percentUploaded:100,status:N.UPLOADING})},function(e){return function(){return e.refs.basicUploadForm.getDOMNode().submit()}}(this)):null!=r?(e="C:\\fakepath\\",0===r.indexOf(e)?this.setState({basicUploaderFile:new T({name:r.slice(e.length),size:null,dest:this.state.path,userId:this.state.user.id,percentUploaded:100,status:N.UPLOADING})},function(e){return function(){return e.refs.basicUploadForm.getDOMNode().submit()}}(this)):this.refs.basicUploadForm.getDOMNode().submit()):void 0},_renderIntroModalButtons:function(){return Z.div({className:"db-modal-buttons"},Z.div({className:"uploader-footer-text",style:{"float":"left",marginTop:18}},null!=this.state.basicUploaderFile?z("This may take a while depending on the size of the file."):this.state.usingBasicUploader?V(C,{},'Uploading multiple files? Try our <a class="enhanced-uploader-link" href="#">enhanced uploader</a>.'):V(C,{},'Having problems? Try the <a class="basic-uploader-link" href="#">basic uploader</a>.')),this.state.usingBasicUploader?null==this.state.basicUploaderFile?V(W,{className:"dbmodal-button",onMouseMove:this._handleBasicChooseButtonMouseMove},z("Choose a file")):void 0:V(W,{ref:"pluFileChooseButton",className:"dbmodal-button"},z("Choose files")),null==this.state.basicUploaderFile?V(W,{importance:"tertiary",className:"dbmodal-button",onClick:this._handleClose},z("Cancel")):void 0)},_renderFileListModalButtons:function(){var e;return e=this.state.fileList.find(function(e){var t;return(t=e.status)===N.PENDING||t===N.UPLOADING}),Z.div({className:"db-modal-buttons"},V(W,{ref:"pluFileChooseButton",importance:"secondary",className:"dbmodal-button",style:{"float":"left",marginLeft:0,marginRight:16}},z("Add more files")),e?void 0:Z.div({className:"uploader-footer-text",style:{"float":"left",marginTop:16}},V(C,{},'Having problems? Try the <a class="basic-uploader-link" href="#">basic uploader</a>.')),V(W,{importance:e?"tertiary":"primary",className:"dbmodal-button",onClick:this._handleClose},z(e?"Hide":"Done")))},_renderIntroMessage:function(){var e;return e=q({user:this.state.user,path:this.state.path,useHTMLFormatting:!1}),Z.span({},this.state.usingBasicUploader?V(C,{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"',upload_folder_name:e},"Choose a file to %(upload_folder_name)s. The basic uploader can only upload one file at a time."):this.props.dragAndDropEnabled?V(C,{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"',upload_folder_name:e},"Choose files to %(upload_folder_name)s. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading."):V(C,{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"',upload_folder_name:e},"Choose files to %(upload_folder_name)s. You can select more than one file at a time."))},_renderDropzone:function(){return Z.div({ref:"dropzone",id:this.DROPZONE_ID,style:{display:"none"}},Z.div({},V(A,{comment:"upload_action is a phrase like 'upload to folder 'XYZ'",n:this.state.numDraggingFiles,upload_action:q({user:this.state.user,path:this.state.path,maxLength:20,useHTMLFormatting:!1})},"Drop your file to %(upload_action)s","Drop your files to %(upload_action)s")))},_renderFileListRowStatus:function(e){var t;return Z.div({className:"status-col"},e.status===N.UPLOADING&&100===e.percentUploaded?V(g,{src:se("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:se("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):(t=e.status)===N.PENDING||t===N.UPLOADING?Z.button({className:"button-as-link",onClick:function(t){return function(i){return i.preventDefault(),t._handleCancel(e)}}(this)},V(m,{group:"web",name:"xclose",alt:z("Cancel")})):e.status===N.COMPLETE?V(m,{group:"web",name:"s_check",alt:z("Upload successful")}):e.status===N.CANCELLED?V(g,{src:se("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:se("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:z("Upload cancelled")}):e.status===N.FAILED?V(g,{src:se("/static/images/nosync-vfl18cuTS.png"),srcHiRes:se("/static/images/nosync@2x-vflgS4F07.png"),alt:z("Error")}):void 0)},_renderFileListRowError:function(e){var t,i;return t=(null!=(i=e.errorMessage)?i.length:void 0)>0?e.errorMessage:z("Something went wrong while uploading this file. If the problem persists, please try the basic uploader."),Z.div({className:"error-col"},Z.span({className:"error-msg"},z(e.errorType===G.FILE_SIZE_ERROR?"File too large":"Upload Error")),Z.span({className:"error-details"},V(x,{position:M.RIGHT,tooltip_contents:Z.div({},t),tooltip_classname:"upload-error-tooltip"},V(m,{group:"web",name:"information",alt:z("More information")}))))},_renderFileListRowDest:function(e){var t,i,n;return Z.div({className:"dest-col"},e.status===N.CANCELLED?z("Canceled"):(n=p.get_viewer().get_user_by_id(e.userId),t=X(n),i=K(n),Z.a({href:j(n,e.dest).toString()},f.em_snippet(""+i+e.dest,this.DEST_SNIPPET_LENGTH,0))))},_renderFileListRow:function(e,t){var i,n;return i=e.status===N.UPLOADING?e.percentUploaded:e.status===N.PENDING?0:100,n={"upload-file":!0,complete:e.status===N.COMPLETE,cancelled:e.status===N.CANCELLED,error:e.status===N.FAILED},Z.li({className:Y(n),key:e.uploadId},Z.div({className:"upload-progress-bar",style:{width:i+"%"}}),Z.div({className:"upload-file-info",style:{overflow:"hidden"}},Z.div({className:"filename-col"},V(m,{group:"web",name:c.file_icon(e.name)}),Z.span({className:"filename"},f.em_snippet(e.name,this.FILENAME_SNIPPET_LENGTH)),null!=e.size?Z.span({className:"size"}," - ",v.format_bytes(e.size)):void 0),e.status!==N.FAILED?t?this._renderFileListRowDest(e):void 0:this._renderFileListRowError(e),this._renderFileListRowStatus(e)))},_renderFileList:function(e,t){var i,n,r;return r=null!=(n=(null!=t?t:{}).shouldShowDestinationLink)?n:!0,Z.ol({ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},function(){var t,n,s;for(s=[],t=0,n=e.length;n>t;t++)i=e[t],s.push(this._renderFileListRow(i,r));return s}.call(this))},_renderTimeLeft:function(){var e;return e=this.state.currentUpload,null!=e&&e.status===N.UPLOADING?Z.div({style:{marginTop:8,textAlign:"right"}},z("%(time_left)s left").format({time_left:E.format_time(this.state.numSecondsLeft)})):void 0},_renderBasicUploaderForm:function(){return Z.form({id:"basic-upload-form",ref:"basicUploadForm",encType:"multipart/form-data",noValidate:"novalidate",method:"post",action:"https://"+L.BLOCK_CLUSTER+"/upload"},Z.input({type:"hidden",name:"t",value:P.read(S.JS_CSRF_COOKIE)}),Z.input({type:"hidden",name:"_subject_uid",value:this.state.user.id}),Z.input({type:"hidden",name:"plain",value:"yes"}),Z.input({type:"hidden",name:"dest",value:this.state.path}),Z.input({type:"file",name:"file","aria-label":z("Upload file"),tabIndex:"-1",style:{position:"absolute",cursor:"pointer",width:100,margin:0,clip:"rect(0px, 100px, 5px, 95px)",opacity:0},ref:"fileInput",onChange:this._handleBasicFileInputChange}))},render:function(){return Z.div({ref:"container"},this._renderDropzone(),V(R,{ref:"modal",title:z("Upload to Dropbox"),showX:!1,buttonComponent:0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:function(e){return function(t){return null!=e.state.basicUploaderFile?void t.preventDefault():B.setIsUploadModalOpen({isUploadModalOpen:!1})}}(this)},this.state.usingBasicUploader?this._renderBasicUploaderForm():void 0,null!=this.state.basicUploaderFile?this._renderFileList([this.state.basicUploaderFile],{shouldShowDestinationLink:!1}):0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroMessage():this._renderFileList(this.state.fileList.toArray()),this._renderTimeLeft()))}}),w=u.createClass({displayName:"InlineUploadStatus",propTypes:{fileList:u.PropTypes.instanceOf(h.OrderedMap).isRequired,currentUpload:u.PropTypes.instanceOf(T),numSecondsLeft:u.PropTypes.number,onViewDetails:u.PropTypes.func},FILENAME_SNIPPET_LENGTH:30,_getOverallUploadState:function(){return this.props.fileList.find(function(e){var t;return(t=e.status)===N.PENDING||t===N.UPLOADING})?"uploading":this.props.fileList.find(function(e){return e.status===N.FAILED})?"error":"complete"},_getProgressBarWidth:function(){var e;return e=this._getOverallUploadState(),"uploading"===e&&null!=this.props.currentUpload?this.props.currentUpload.percentUploaded:"complete"===e||"error"===e?100:0},_getNumPendingFiles:function(){return this.props.fileList.count(function(e){return e.status===N.PENDING})},_getNumCompletedFiles:function(){return this.props.fileList.count(function(e){return e.status===N.COMPLETE})},_getNumNoncancelledFiles:function(){return this.props.fileList.count(function(e){return e.status!==N.CANCELLED})},_getNumErrors:function(){return this.props.fileList.count(function(e){return e.status===N.FAILED})},_renderIcon:function(){var e;return e=this._getOverallUploadState(),"uploading"===e?V(m,{group:"web",name:"s_sync",alt:z("Uploading")}):"complete"===e?V(m,{group:"web",name:"s_check",alt:z("Upload successful")}):V(g,{src:se("/static/images/nosync-vfl18cuTS.png"),srcHiRes:se("/static/images/nosync@2x-vflgS4F07.png"),alt:z("Error")})},_renderCloseButton:function(){return Z.button({className:"button-as-link",onClick:function(e){return e.preventDefault(),B.setIsInlineStatusDismissed({isInlineStatusDismissed:!0})}},V(m,{group:"web",name:"xclose",alt:z("Close")}))},_renderViewDetailsLink:function(){var e;return e=this._getNumPendingFiles(),Z.span({className:"details"}," - ",Z.button({className:"view-details button-as-link",onClick:function(e){return function(t){var i;return t.preventDefault(),"function"==typeof(i=e.props).onViewDetails?i.onViewDetails():void 0}}(this)},e>0?ae("%(num_pending_files)d file left","%(num_pending_files)d files left",e).format({num_pending_files:e}):z("View details")))},_renderFileDescription:function(){var e,t,i,n;return n=this._getOverallUploadState(),i=this._getNumNoncancelledFiles(),t=this._getNumErrors(),Z.span({className:"file-desc"},null!=this.props.currentUpload?z("Uploading %(filename)s").format({filename:f.em_snippet(this.props.currentUpload.name,this.FILENAME_SNIPPET_LENGTH)}):"uploading"===n?z("Starting upload..."):"complete"===n?i>1?z("Uploaded %(num_files)d files").format({num_files:i}):z("Uploaded %(filename)s").format({filename:f.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):"error"===n?i>1?[z("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:this._getNumCompletedFiles(),num_files:i})," ",Z.span({className:"num-errors"},ae("- %d error","- %d errors",t).format(t))]:(e=this.props.fileList.last().errorType,e===G.GENERIC?z("Unable to upload %(filename)s").format({filename:f.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):z("Unable to upload %(filename)s: %(reason)s").format({filename:f.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH),reason:function(){switch(e){case G.OVER_QUOTA_ERROR:return z("over quota");case G.FILE_SIZE_ERROR:return z("file too large");case G.CONNECTION_ERROR:return z("lost connection");case G.HTTP_ERROR:return z("server error");case G.EMPTY_OR_FOLDER:return z("can’t upload folders or empty files");case G.PACKAGE_FILE:return z("OSX package file")}}()})):void 0)},render:function(){var e,t;return e=this._getOverallUploadState(),t={"upload-file":!0,error:"error"===e,complete:"complete"===e},Z.div({id:"inline-upload-status",className:Y(t)},Z.div({className:"inline-upload-info"},Z.div({className:"icon"},this._renderIcon()),Z.div({className:"files-info"},this._renderFileDescription(),Z.span({className:"num-errors"}),this._renderViewDetailsLink()),Z.div({className:"status"},"uploading"===e&&null!=this.props.numSecondsLeft?z("%(time_left)s left").format({time_left:E.format_time(this.props.numSecondsLeft)}):this._renderCloseButton())),Z.div({className:"inline-upload-bar"},Z.div({className:"inline-upload-progress",style:{width:this._getProgressBarWidth()+"%"}})))}}),O=u.createClass({displayName:"FileUploader",mixins:[l(k)],propTypes:{dragAndDropEnabled:u.PropTypes.bool,onFileUploadComplete:u.PropTypes.func,onAllFileUploadsComplete:u.PropTypes.func,hasPermissionToUploadToFolder:u.PropTypes.bool},getDefaultProps:function(){return{dragAndDropEnabled:!0,onFileUploadComplete:function(){},onAllFileUploadsComplete:function(){},hasPermissionToUploadToFolder:!0}},_get_state_from_stores:function(){return{path:k.path(),user:k.user(),fileList:k.fileList(),numDraggingFiles:k.numDraggingFiles(),currentUpload:k.currentUpload(),isUploadModalOpen:k.isUploadModalOpen(),numSecondsLeft:k.numSecondsLeft(),isInlineStatusDismissed:k.isInlineStatusDismissed()}},INLINE_STATUS_CONTAINER_CLASS:"inline-upload-status-container",showModal:function(){return R.showInstance(V(b,{dragAndDropEnabled:this.props.dragAndDropEnabled})),B.setIsUploadModalOpen({isUploadModalOpen:!0})},componentDidMount:function(){var t;return B.initPLU(),this.dragEnterCount=0,this.lastEnteredElement=null,t=e(document.body),t.on("dragover.fileUploader",function(e){return e.preventDefault(),e.stopPropagation()}).on("dragenter.fileUploader",function(e){return function(t){var i,n;return t.preventDefault(),t.stopPropagation(),t.target!==e.lastEnteredElement?(e.lastEnteredElement=t.target,e.dragEnterCount+=1,i=function(){var e;try{return null!=(e=t.originalEvent.dataTransfer.mozItemCount)?e:Object.keys(t.originalEvent.dataTransfer.items).length}catch(i){return 1}}(),n=t.originalEvent.dataTransfer.types,null!=n&&(null!=n.indexOf&&n.indexOf("Files")>-1||n.contains("application/x-moz-file")||n instanceof DOMStringList&&n.contains("Files"))?B.setNumDraggingFiles({numDraggingFiles:i}):void 0):void 0}}(this)).on("dragleave.fileUploader",function(e){return function(t){return t.preventDefault(),t.stopPropagation(),e.lastEnteredElement=null,e.dragEnterCount-=1,e.dragEnterCount<1?(e.dragEnterCount=0,B.setNumDraggingFiles({numDraggingFiles:0})):void 0}}(this)).on("drop.fileUploader",this._handleFileDrop),e("<div>").addClass(this.INLINE_STATUS_CONTAINER_CLASS).prependTo(e("#page-content")),e(window).on("beforeunload.fileUploader",function(e){return function(t){var i,n;return i=null!=e.state.fileList.find(function(e){var t;return(t=e.status)===N.PENDING||t===N.UPLOADING}),i&&e.state.fileList.count()>0?(n=z("Leaving this page will cancel your uploads."),t.returnValue=n,n):void 0}}(this))},updateInlineStatus:function(){var t,i,n;return n=null!=this.state.fileList.find(function(e){var t;return(t=e.status)===N.PENDING||t===N.UPLOADING}),i=!this.state.isUploadModalOpen&&(n||this.state.fileList.count()>0&&!n&&!this.state.isInlineStatusDismissed),t=e("."+this.INLINE_STATUS_CONTAINER_CLASS),i?u.render(V(w,{fileList:this.state.fileList,currentUpload:this.state.currentUpload,onViewDetails:this._handleInlineStatusViewDetails,numSecondsLeft:this.state.numSecondsLeft}),t[0]):u.unmountComponentAtNode(t[0])},componentWillUpdate:function(e,t){var i,n,r;return null==t.currentUpload&&null!=this.state.currentUpload&&"function"==typeof(i=this.props).onFileUploadComplete&&i.onFileUploadComplete(this.state.currentUpload),t.fileList!==this.state.fileList&&(r=null!=t.fileList.find(function(e){var t;return(t=e.status)===N.PENDING||t===N.UPLOADING}),!r&&t.fileList.count()>0)&&"function"==typeof(n=this.props).onAllFileUploadsComplete?n.onAllFileUploadsComplete(this.state.fileList):void 0},componentDidUpdate:function(t,r){var s,o;return s=e(".external-drop-indicator"),this.state.numDraggingFiles?(r.numDraggingFiles||s.css("opacity",0).fadeTo(500,.6),this.props.hasPermissionToUploadToFolder?s.removeClass("external-drop-indicator--uploads-disabled"):s.addClass("external-drop-indicator--uploads-disabled"),this.state.isUploadModalOpen||(this.props.hasPermissionToUploadToFolder?(o=ae("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",this.state.numDraggingFiles,{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:q({user:this.state.user,path:this.state.path,useHTMLFormatting:!1})}),i.success(new n(o),60)):i.error(z("You don’t have permission to add to this folder.")))):(s.hide().removeClass("external-drop-indicator--uploads-disabled"),i.clear()),this.updateInlineStatus()},componentWillUnmount:function(){return e(document).off("dragover.fileUploader").off("dragenter.fileUploader").off("dragleave.fileUploader").off("drop.fileUploader"),e("."+this.INLINE_STATUS_CONTAINER_CLASS).remove(),e(window).off("beforeunload.fileUploader")},_handleFileDrop:function(e){var t,i,n,r,s,o,a,l,u,d,p;if(e.preventDefault(),e.stopPropagation(),this.dragEnterCount=0,B.setNumDraggingFiles({
numDraggingFiles:0}),this.props.hasPermissionToUploadToFolder)if(l=e.originalEvent.dataTransfer.items,o=e.originalEvent.dataTransfer.files,null!=(null!=l&&null!=(p=l[0])?p.webkitGetAsEntry:void 0)){for(n=function(){var e,t,i;for(i=[],a=e=0,t=l.length;t>=0?t>e:e>t;a=t>=0?++e:--e)i.push(l[a].webkitGetAsEntry());return i}(),r=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)i=n[e],i.isFile&&r.push(i);return r}(),t=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)i=n[e],i.isDirectory&&r.push(i);return r}(),u=0,d=r.length;d>u;u++)s=r[u],s.file(function(e){return B.addFilesToPLU({files:[e]})});if(t.length>0)return B.addDirectoriesToPLU({directoryEntries:t})}else if(null!=(null!=o?o.length:void 0))return o=function(){var e,t,i;for(i=[],a=e=0,t=o.length;t>=0?t>e:e>t;a=t>=0?++e:--e)i.push(o.item(a));return i}(),B.addFilesToPLU({files:o})},_handleInlineStatusViewDetails:function(){return this.showModal()},render:function(){return Z.div({})}}),{FileUploader:O}}),define("modules/dirty/recent_activity/recents_global_actions",["jquery","external/underscore","external/react","modules/clean/page_role_observer","modules/clean/react/sprite","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/uploader","modules/clean/viewer","modules/constants/viewer","modules/core/i18n"],function(e,t,i,n,r,s,o,a,l,u){var d,p,c,f,h,_,m,g;return h=s.UploaderActions,d=o.FileUploader,c=l.ROLE_WORK,p=l.ROLE_PERSONAL,_=u._,m=i.addons.classSet,g=i.DOM,f=i.createClass({displayName:"RecentsGlobalActions",propTypes:{role:i.PropTypes.oneOf([c,p]).isRequired,treeviewId:i.PropTypes.string.isRequired},getInitialState:function(){return{role:this.props.role}},componentWillMount:function(){return h.setUser({user:this._currentUser()}),n.addListener(this._onRoleChange)},componentDidMount:function(){return require(["dropbox"])},componentWillUnmount:function(){return n.removeListener(this._onRoleChange)},_renderIcon:function(e){return i.createElement(r,{ref:"icon",group:"web",name:e,alt:""})},_currentUser:function(){return a.get_viewer().get_user_by_role(this.state.role)},_onRoleChange:function(e){return e!==this.state.role?(this.setState({role:e}),h.setUser({user:this._currentUser()})):void 0},_showUploader:function(e){return e.preventDefault(),this.refs.fileUploader.showModal()},_showShareDialog:function(e){return e.preventDefault(),require(["dropbox"],function(e){return function(t){var i,n,r;return n=t.SharingModals,r=t.TreeView,i=t.FileOps,r.init(i.dir_handler,!1,e.props.treeviewId),n.start_wizard_for_user(e._currentUser())}}(this))},render:function(){var e,t,n;return t=g.a({href:"#",ref:"uploadButton",onClick:this._showUploader,className:m("recents-global-actions__action","recents-global-actions__action--upload-link")},this._renderIcon("upload_16"),_("Upload")),e=g.a({href:"#",ref:"shareFolderButton",onClick:this._showShareDialog,className:m("recents-global-actions__action","recents-global-actions__action--share-folder")},this._renderIcon("rainbow_16"),_("Share a folder")),n=i.createElement(d,{ref:"fileUploader"}),g.div({className:"recents-global-actions"},n,t,e)}}),{RecentsGlobalActions:f}});