// Generated by CoffeeScript 1.10.0
define(['modules/clean/notifications/file_watcher', 'modules/clean/notifications/updated_file_notification', 'modules/core/visibility'], function(FileWatcher, UpdatedFileNotification, visibility) {
  var FilePreviewUpdateWatcher;
  FilePreviewUpdateWatcher = (function() {
    function FilePreviewUpdateWatcher(file, user, refresh) {
      this.file = file;
      this.user = user;
      this.refresh = refresh;
      this._watchFile();
    }

    FilePreviewUpdateWatcher.prototype.stop = function() {
      this._hideUpdatedFileNotification();
      return this._unwatchFile();
    };

    FilePreviewUpdateWatcher.prototype._watchFile = function() {
      return this._subscription = FileWatcher.subscribe(this.file, this.user, this._onFileUpdate.bind(this));
    };

    FilePreviewUpdateWatcher.prototype._unwatchFile = function() {
      var ref;
      if ((ref = this._subscription) != null) {
        ref.cancel();
      }
      return delete this._subscription;
    };

    FilePreviewUpdateWatcher.prototype._showUpdatedFileNotification = function() {
      if (!this._subscription) {
        return;
      }
      this._hideUpdatedFileNotification();
      return this._notification = new UpdatedFileNotification(this._onRefresh.bind(this));
    };

    FilePreviewUpdateWatcher.prototype._hideUpdatedFileNotification = function() {
      var ref;
      if ((ref = this._notification) != null) {
        ref.hide();
      }
      return delete this._notification;
    };

    FilePreviewUpdateWatcher.prototype._onFileUpdate = function() {
      return visibility.when().then(this._showUpdatedFileNotification.bind(this));
    };

    FilePreviewUpdateWatcher.prototype._onRefresh = function() {
      if (!this._subscription) {
        return;
      }
      this._hideUpdatedFileNotification();
      return this.refresh(this._subscription.file);
    };

    return FilePreviewUpdateWatcher;

  })();
  return FilePreviewUpdateWatcher;
});

//# sourceMappingURL=file_preview_update_watcher.js.map
